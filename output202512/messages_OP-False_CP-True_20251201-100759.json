{
  "brief": [
    {
      "topic": "brief",
      "sender": "User",
      "content": "\n为网站创建一个响应式且视觉效果吸引人的电商产品销售页面小部件。\n用户应能够浏览商品列表、查看商品详情、选择数量并加入购物车，以及从购物车中删除商品。页面应支持显示商品价格、折扣信息、库存状态和按分类浏览等功能。\n您还可以添加任何其他创意功能来提高转化率和趣味性，例如限时倒计时、热销标记或简易订单摘要。\n仅使用 HTML、CSS 和 JavaScript — 不要使用 Vue、React 或任何第三方库。使用 localStorage 存储购物车等数据，确保信息在页面刷新后仍能保留。保持整体设计简洁、用户友好且引人入胜。\n"
    }
  ],
  "tasks": [
    {
      "topic": "tasks",
      "sender": "TeamLeader",
      "content": {
        "available_roles": [
          "TeamLeader",
          "Engineer"
        ],
        "tasks": [
          {
            "role": "TeamLeader",
            "tasks": [
              "分析客户需求，确定开发电商产品页面小部件的规格",
              "明确技术约束：纯 HTML/CSS/JS，使用 localStorage"
            ]
          },
          {
            "role": "Engineer",
            "tasks": [
              "构建 HTML 结构（商品列表、购物车侧边栏/区域、筛选器）",
              "设计 CSS 样式（响应式布局、视觉美化、动画效果）",
              "编写 JavaScript 逻辑（商品渲染、购物车状态管理、分类筛选、localStorage 数据持久化）"
            ]
          }
        ]
      }
    }
  ],
  "html": [
    {
      "topic": "html",
      "sender": "Engineer",
      "content": "<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>极简电商小部件</title>\n    <style>\n        :root {\n            --primary: #2563eb;\n            --primary-dark: #1d4ed8;\n            --secondary: #f97316;\n            --dark: #1e293b;\n            --light: #f8fafc;\n            --gray: #94a3b8;\n            --border: #e2e8f0;\n            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n        }\n\n        * {\n            box-sizing: border-box;\n            margin: 0;\n            padding: 0;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n        }\n\n        body {\n            background-color: #f1f5f9;\n            color: var(--dark);\n            line-height: 1.5;\n        }\n\n        /* Header */\n        header {\n            background: white;\n            padding: 1rem 2rem;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n            position: sticky;\n            top: 0;\n            z-index: 100;\n        }\n\n        .logo {\n            font-size: 1.5rem;\n            font-weight: 800;\n            color: var(--primary);\n            letter-spacing: -1px;\n        }\n\n        .cart-trigger {\n            position: relative;\n            cursor: pointer;\n            padding: 0.5rem;\n        }\n\n        .cart-icon {\n            width: 24px;\n            height: 24px;\n        }\n\n        .cart-badge {\n            position: absolute;\n            top: -2px;\n            right: -5px;\n            background: var(--secondary);\n            color: white;\n            font-size: 0.75rem;\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            font-weight: bold;\n        }\n\n        /* Promo Banner */\n        .promo-banner {\n            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);\n            color: white;\n            text-align: center;\n            padding: 1.5rem;\n            margin-bottom: 2rem;\n        }\n\n        .countdown {\n            font-weight: bold;\n            color: var(--secondary);\n            font-family: monospace;\n            font-size: 1.2rem;\n        }\n\n        /* Container */\n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 0 1rem;\n        }\n\n        /* Filters */\n        .filters {\n            display: flex;\n            gap: 1rem;\n            margin-bottom: 2rem;\n            overflow-x: auto;\n            padding-bottom: 0.5rem;\n        }\n\n        .filter-btn {\n            border: none;\n            background: white;\n            padding: 0.5rem 1.2rem;\n            border-radius: 2rem;\n            cursor: pointer;\n            font-weight: 600;\n            color: var(--gray);\n            transition: all 0.2s;\n            border: 1px solid transparent;\n            white-space: nowrap;\n        }\n\n        .filter-btn.active, .filter-btn:hover {\n            background: var(--primary);\n            color: white;\n            box-shadow: var(--shadow);\n        }\n\n        /* Product Grid */\n        .product-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n            gap: 2rem;\n            padding-bottom: 4rem;\n        }\n\n        .product-card {\n            background: white;\n            border-radius: 1rem;\n            overflow: hidden;\n            transition: transform 0.3s, box-shadow 0.3s;\n            position: relative;\n            border: 1px solid var(--border);\n            display: flex;\n            flex-direction: column;\n        }\n\n        .product-card:hover {\n            transform: translateY(-5px);\n            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n        }\n\n        .badge {\n            position: absolute;\n            top: 1rem;\n            left: 1rem;\n            padding: 0.25rem 0.75rem;\n            border-radius: 4px;\n            font-size: 0.75rem;\n            font-weight: bold;\n            color: white;\n            z-index: 10;\n        }\n\n        .badge.hot { background: var(--secondary); }\n        .badge.sale { background: #ef4444; }\n\n        .card-img-wrapper {\n            height: 200px;\n            width: 100%;\n            overflow: hidden;\n            background: #eee;\n            position: relative;\n            cursor: pointer;\n        }\n\n        .card-img-wrapper img {\n            width: 100%;\n            height: 100%;\n            object-fit: cover;\n            transition: transform 0.5s;\n        }\n\n        .product-card:hover img {\n            transform: scale(1.05);\n        }\n\n        .card-body {\n            padding: 1.5rem;\n            flex-grow: 1;\n            display: flex;\n            flex-direction: column;\n        }\n\n        .card-category {\n            font-size: 0.75rem;\n            color: var(--gray);\n            text-transform: uppercase;\n            letter-spacing: 1px;\n            margin-bottom: 0.5rem;\n        }\n\n        .card-title {\n            font-size: 1.1rem;\n            font-weight: 700;\n            margin-bottom: 0.5rem;\n            color: var(--dark);\n        }\n\n        .price-row {\n            display: flex;\n            align-items: baseline;\n            gap: 0.5rem;\n            margin-bottom: 1rem;\n        }\n\n        .current-price {\n            font-size: 1.25rem;\n            font-weight: 800;\n            color: var(--primary);\n        }\n\n        .original-price {\n            text-decoration: line-through;\n            color: var(--gray);\n            font-size: 0.9rem;\n        }\n\n        .stock-info {\n            font-size: 0.85rem;\n            margin-bottom: 1rem;\n            color: #10b981;\n        }\n\n        .stock-info.low { color: #ef4444; }\n\n        .card-actions {\n            margin-top: auto;\n            display: flex;\n            gap: 0.5rem;\n        }\n\n        .btn {\n            padding: 0.75rem 1rem;\n            border: none;\n            border-radius: 0.5rem;\n            cursor: pointer;\n            font-weight: 600;\n            transition: background 0.2s;\n            display: inline-flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .btn-primary {\n            background: var(--primary);\n            color: white;\n            flex-grow: 1;\n        }\n\n        .btn-primary:hover { background: var(--primary-dark); }\n\n        .btn-outline {\n            background: white;\n            border: 1px solid var(--border);\n            color: var(--dark);\n        }\n\n        .btn-outline:hover { background: var(--light); }\n\n        /* Cart Sidebar */\n        .cart-sidebar {\n            position: fixed;\n            top: 0;\n            right: -400px;\n            width: 400px;\n            max-width: 100%;\n            height: 100vh;\n            background: white;\n            box-shadow: -5px 0 15px rgba(0,0,0,0.1);\n            z-index: 1000;\n            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n            display: flex;\n            flex-direction: column;\n        }\n\n        .cart-sidebar.open {\n            right: 0;\n        }\n\n        .cart-header {\n            padding: 1.5rem;\n            border-bottom: 1px solid var(--border);\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .cart-items {\n            flex-grow: 1;\n            overflow-y: auto;\n            padding: 1.5rem;\n        }\n\n        .cart-item {\n            display: flex;\n            gap: 1rem;\n            margin-bottom: 1.5rem;\n            border-bottom: 1px solid var(--light);\n            padding-bottom: 1rem;\n        }\n\n        .cart-item img {\n            width: 70px;\n            height: 70px;\n            object-fit: cover;\n            border-radius: 0.5rem;\n        }\n\n        .cart-item-details {\n            flex-grow: 1;\n        }\n\n        .cart-item-title {\n            font-weight: 600;\n            font-size: 0.95rem;\n        }\n\n        .cart-item-controls {\n            display: flex;\n            align-items: center;\n            gap: 0.75rem;\n            margin-top: 0.5rem;\n        }\n\n        .qty-btn {\n            width: 24px;\n            height: 24px;\n            border-radius: 4px;\n            border: 1px solid var(--border);\n            background: white;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            cursor: pointer;\n        }\n\n        .cart-footer {\n            padding: 1.5rem;\n            border-top: 1px solid var(--border);\n            background: var(--light);\n        }\n\n        .cart-total {\n            display: flex;\n            justify-content: space-between;\n            font-size: 1.2rem;\n            font-weight: 800;\n            margin-bottom: 1rem;\n        }\n\n        .overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0,0,0,0.5);\n            z-index: 900;\n            opacity: 0;\n            pointer-events: none;\n            transition: opacity 0.3s;\n        }\n\n        .overlay.active {\n            opacity: 1;\n            pointer-events: auto;\n        }\n\n        /* Product Details Modal */\n        .modal {\n            position: fixed;\n            top: 50%;\n            left: 50%;\n            transform: translate(-50%, -50%) scale(0.9);\n            background: white;\n            padding: 2rem;\n            border-radius: 1rem;\n            z-index: 1100;\n            max-width: 800px;\n            width: 90%;\n            opacity: 0;\n            pointer-events: none;\n            transition: all 0.3s;\n            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);\n        }\n\n        .modal.active {\n            opacity: 1;\n            pointer-events: auto;\n            transform: translate(-50%, -50%) scale(1);\n        }\n\n        .modal-content {\n            display: grid;\n            grid-template-columns: 1fr 1fr;\n            gap: 2rem;\n        }\n\n        .modal-img {\n            width: 100%;\n            height: 300px;\n            object-fit: cover;\n            border-radius: 0.5rem;\n        }\n\n        .close-modal {\n            position: absolute;\n            top: 1rem;\n            right: 1rem;\n            background: none;\n            border: none;\n            font-size: 1.5rem;\n            cursor: pointer;\n        }\n\n        /* Toast Notification */\n        .toast {\n            position: fixed;\n            bottom: 2rem;\n            left: 50%;\n            transform: translateX(-50%) translateY(100px);\n            background: var(--dark);\n            color: white;\n            padding: 0.75rem 1.5rem;\n            border-radius: 2rem;\n            box-shadow: var(--shadow);\n            z-index: 2000;\n            transition: transform 0.3s;\n            display: flex;\n            align-items: center;\n            gap: 0.5rem;\n        }\n\n        .toast.show {\n            transform: translateX(-50%) translateY(0);\n        }\n\n        @media (max-width: 768px) {\n            .cart-sidebar { width: 100%; right: -100%; }\n            .modal-content { grid-template-columns: 1fr; }\n            .modal-img { height: 200px; }\n        }\n    </style>\n</head>\n<body>\n\n    <!-- Header -->\n    <header>\n        <div class=\"logo\">NEXUS<span style=\"color:var(--dark)\">STORE</span></div>\n        <div class=\"cart-trigger\" onclick=\"toggleCart()\">\n            <svg class=\"cart-icon\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke-width=\"2\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\"></path></svg>\n            <div class=\"cart-badge\" id=\"cart-count\">0</div>\n        </div>\n    </header>\n\n    <!-- Banner -->\n    <div class=\"promo-banner\">\n        <h2>限时闪购季 - 全场低至 5 折</h2>\n        <p>优惠结束倒计时: <span class=\"countdown\" id=\"countdown\">02:00:00</span></p>\n    </div>\n\n    <!-- Main Content -->\n    <div class=\"container\">\n        <!-- Filters -->\n        <div class=\"filters\" id=\"filters\">\n            <button class=\"filter-btn active\" onclick=\"filterProducts('all')\">全部商品</button>\n            <button class=\"filter-btn\" onclick=\"filterProducts('electronics')\">数码电子</button>\n            <button class=\"filter-btn\" onclick=\"filterProducts('fashion')\">潮流服饰</button>\n            <button class=\"filter-btn\" onclick=\"filterProducts('lifestyle')\">生活家居</button>\n        </div>\n\n        <!-- Product Grid -->\n        <div class=\"product-grid\" id=\"product-grid\">\n            <!-- Products will be injected here via JS -->\n        </div>\n    </div>\n\n    <!-- Cart Sidebar -->\n    <div class=\"overlay\" id=\"overlay\" onclick=\"toggleCart(); closeModal()\"></div>\n    <div class=\"cart-sidebar\" id=\"cart-sidebar\">\n        <div class=\"cart-header\">\n            <h3>我的购物车</h3>\n            <button class=\"btn-outline\" style=\"border:none; font-size:1.5rem;\" onclick=\"toggleCart()\">&times;</button>\n        </div>\n        <div class=\"cart-items\" id=\"cart-items\">\n            <!-- Cart items injected here -->\n            <p style=\"text-align:center; color:var(--gray); margin-top:2rem;\">购物车是空的</p>\n        </div>\n        <div class=\"cart-footer\">\n            <div class=\"cart-total\">\n                <span>总计</span>\n                <span id=\"cart-total-price\">¥0.00</span>\n            </div>\n            <button class=\"btn btn-primary\" style=\"width:100%\" onclick=\"checkout()\">立即结账</button>\n        </div>\n    </div>\n\n    <!-- Product Detail Modal -->\n    <div class=\"modal\" id=\"product-modal\">\n        <button class=\"close-modal\" onclick=\"closeModal()\">&times;</button>\n        <div class=\"modal-content\" id=\"modal-content\">\n            <!-- Content injected here -->\n        </div>\n    </div>\n\n    <!-- Toast Notification -->\n    <div class=\"toast\" id=\"toast\">\n        <svg width=\"20\" height=\"20\" fill=\"none\" stroke=\"#4ade80\" stroke-width=\"2\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M5 13l4 4L19 7\"></path></svg>\n        <span id=\"toast-msg\">已加入购物车</span>\n    </div>\n\n    <script>\n        // === 数据模拟 ===\n        const products = [\n            {\n                id: 1,\n                name: \"无线降噪耳机 Pro\",\n                category: \"electronics\",\n                price: 1299,\n                originalPrice: 1599,\n                image: \"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?w=500&auto=format&fit=crop&q=60\",\n                stock: 5,\n                hot: true,\n                description: \"沉浸式音频体验，40小时超长续航，智能主动降噪技术。\"\n            },\n            {\n                id: 2,\n                name: \"复古胶片相机\",\n                category: \"electronics\",\n                price: 2499,\n                originalPrice: 2499,\n                image: \"https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?w=500&auto=format&fit=crop&q=60\",\n                stock: 2,\n                hot: false,\n                description: \"经典光学设计，捕捉生活每一个珍贵瞬间，附赠真皮保护套。\"\n            },\n            {\n                id: 3,\n                name: \"极简纯棉T恤\",\n                category: \"fashion\",\n                price: 99,\n                originalPrice: 129,\n                image: \"https://images.unsplash.com/photo-1521572163474-6864f9cf17ab?w=500&auto=format&fit=crop&q=60\",\n                stock: 50,\n                hot: true,\n                sale: true,\n                description: \"100% 有机棉，透气舒适，百搭经典版型。\"\n            },\n            {\n                id: 4,\n                name: \"智能运动手表\",\n                category: \"electronics\",\n                price: 899,\n                originalPrice: 1099,\n                image: \"https://images.unsplash.com/photo-1523275335684-37898b6baf30?w=500&auto=format&fit=crop&q=60\",\n                stock: 10,\n                hot: false,\n                description: \"心率监测、睡眠分析、防水设计，您的私人健康管家。\"\n            },\n            {\n                id: 5,\n                name: \"手工陶瓷花瓶\",\n                category: \"lifestyle\",\n                price: 159,\n                originalPrice: 199,\n                image: \"https://images.unsplash.com/photo-1578500494198-246f612d3b3d?w=500&auto=format&fit=crop&q=60\",\n                stock: 8,\n                hot: false,\n                description: \"极简线条设计，为家居空间增添艺术气息。\"\n            },\n            {\n                id: 6,\n                name: \"经典牛仔夹克\",\n                category: \"fashion\",\n                price: 399,\n                originalPrice: 599,\n                image: \"https://images.unsplash.com/photo-1576871337632-b9aef4c17ab9?w=500&auto=format&fit=crop&q=60\",\n                stock: 15,\n                hot: false,\n                sale: true,\n                description: \"复古水洗工艺，耐磨面料，四季皆宜。\"\n            }\n        ];\n\n        // === 状态管理 ===\n        let cart = JSON.parse(localStorage.getItem('nexus_cart')) || [];\n\n        // === 初始化 ===\n        document.addEventListener('DOMContentLoaded', () => {\n            renderProducts('all');\n            updateCartUI();\n            startCountdown();\n        });\n\n        // === 渲染逻辑 ===\n        function renderProducts(filter) {\n            const grid = document.getElementById('product-grid');\n            grid.innerHTML = '';\n\n            const filtered = filter === 'all' ? products : products.filter(p => p.category === filter);\n\n            filtered.forEach(product => {\n                const hasDiscount = product.price < product.originalPrice;\n                const badgeHtml = product.hot \n                    ? `<div class=\"badge hot\">HOT</div>` \n                    : (hasDiscount ? `<div class=\"badge sale\">SALE</div>` : '');\n                \n                const stockClass = product.stock < 5 ? 'low' : '';\n                const stockText = product.stock < 5 ? `仅剩 ${product.stock} 件` : '库存充足';\n\n                const card = document.createElement('div');\n                card.className = 'product-card';\n                card.innerHTML = `\n                    ${badgeHtml}\n                    <div class=\"card-img-wrapper\" onclick=\"openProductModal(${product.id})\">\n                        <img src=\"${product.image}\" alt=\"${product.name}\" loading=\"lazy\">\n                    </div>\n                    <div class=\"card-body\">\n                        <div class=\"card-category\">${product.category}</div>\n                        <div class=\"card-title\">${product.name}</div>\n                        <div class=\"price-row\">\n                            <span class=\"current-price\">¥${product.price}</span>\n                            ${hasDiscount ? `<span class=\"original-price\">¥${product.originalPrice}</span>` : ''}\n                        </div>\n                        <div class=\"stock-info ${stockClass}\">${stockText}</div>\n                        <div class=\"card-actions\">\n                            <button class=\"btn btn-outline\" onclick=\"openProductModal(${product.id})\">详情</button>\n                            <button class=\"btn btn-primary\" onclick=\"addToCart(${product.id})\">加入购物车</button>\n                        </div>\n                    </div>\n                `;\n                grid.appendChild(card);\n            });\n\n            // 更新过滤器按钮状态\n            document.querySelectorAll('.filter-btn').forEach(btn => {\n                btn.classList.remove('active');\n                if(btn.textContent.includes(getCategoryName(filter))) btn.classList.add('active');\n                // 简单映射逻辑，实际可更复杂\n                if(filter === 'all' && btn.textContent === '全部商品') btn.classList.add('active');\n            });\n        }\n\n        function getCategoryName(cat) {\n            const map = { 'electronics': '数码', 'fashion': '服饰', 'lifestyle': '生活' };\n            return map[cat] || '';\n        }\n\n        function filterProducts(category) {\n            renderProducts(category);\n        }\n\n        // === 购物车逻辑 ===\n        function addToCart(id) {\n            const product = products.find(p => p.id === id);\n            const existingItem = cart.find(item => item.id === id);\n\n            if (existingItem) {\n                if (existingItem.qty < product.stock) {\n                    existingItem.qty++;\n                    showToast(`数量增加: ${product.name}`);\n                } else {\n                    showToast('库存不足', true);\n                    return;\n                }\n            } else {\n                cart.push({ ...product, qty: 1 });\n                showToast(`已添加: ${product.name}`);\n            }\n\n            saveCart();\n            updateCartUI();\n        }\n\n        function changeQty(id, delta) {\n            const item = cart.find(item => item.id === id);\n            const product = products.find(p => p.id === id);\n\n            if (item) {\n                const newQty = item.qty + delta;\n                if (newQty > 0 && newQty <= product.stock) {\n                    item.qty = newQty;\n                } else if (newQty <= 0) {\n                    removeFromCart(id);\n                    return;\n                } else {\n                    showToast('库存达到上限', true);\n                }\n                saveCart();\n                updateCartUI();\n            }\n        }\n\n        function removeFromCart(id) {\n            cart = cart.filter(item => item.id !== id);\n            saveCart();\n            updateCartUI();\n        }\n\n        function saveCart() {\n            localStorage.setItem('nexus_cart', JSON.stringify(cart));\n        }\n\n        function updateCartUI() {\n            const cartItemsContainer = document.getElementById('cart-items');\n            const cartCount = document.getElementById('cart-count');\n            const cartTotal = document.getElementById('cart-total-price');\n\n            let totalQty = 0;\n            let totalPrice = 0;\n\n            if (cart.length === 0) {\n                cartItemsContainer.innerHTML = `<p style=\"text-align:center; color:var(--gray); margin-top:2rem;\">购物车是空的</p>`;\n            } else {\n                cartItemsContainer.innerHTML = cart.map(item => {\n                    totalQty += item.qty;\n                    totalPrice += item.price * item.qty;\n                    return `\n                        <div class=\"cart-item\">\n                            <img src=\"${item.image}\" alt=\"${item.name}\">\n                            <div class=\"cart-item-details\">\n                                <div class=\"cart-item-title\">${item.name}</div>\n                                <div style=\"color:var(--gray); font-size:0.85rem;\">¥${item.price}</div>\n                                <div class=\"cart-item-controls\">\n                                    <div class=\"qty-btn\" onclick=\"changeQty(${item.id}, -1)\">-</div>\n                                    <span>${item.qty}</span>\n                                    <div class=\"qty-btn\" onclick=\"changeQty(${item.id}, 1)\">+</div>\n                                    <div style=\"margin-left:auto; color:#ef4444; cursor:pointer; font-size:0.8rem;\" onclick=\"removeFromCart(${item.id})\">删除</div>\n                                </div>\n                            </div>\n                        </div>\n                    `;\n                }).join('');\n            }\n\n            cartCount.textContent = totalQty;\n            cartTotal.textContent = `¥${totalPrice.toFixed(2)}`;\n        }\n\n        // === UI 交互 ===\n        function toggleCart() {\n            const sidebar = document.getElementById('cart-sidebar');\n            const overlay = document.getElementById('overlay');\n            sidebar.classList.toggle('open');\n            overlay.classList.toggle('active');\n        }\n\n        function openProductModal(id) {\n            const product = products.find(p => p.id === id);\n            const modal = document.getElementById('product-modal');\n            const overlay = document.getElementById('overlay');\n            const content = document.getElementById('modal-content');\n\n            content.innerHTML = `\n                <img src=\"${product.image}\" class=\"modal-img\">\n                <div>\n                    <h2 style=\"margin-bottom:0.5rem\">${product.name}</h2>\n                    <div style=\"color:var(--primary); font-size:1.5rem; font-weight:bold; margin-bottom:1rem;\">¥${product.price}</div>\n                    <p style=\"color:var(--gray); margin-bottom:1.5rem;\">${product.description}</p>\n                    <div style=\"margin-bottom:1rem; font-size:0.9rem\">库存: ${product.stock}</div>\n                    <button class=\"btn btn-primary\" style=\"width:100%\" onclick=\"addToCart(${product.id}); closeModal()\">加入购物车</button>\n                </div>\n            `;\n\n            modal.classList.add('active');\n            overlay.classList.add('active');\n            \n            // 确保覆盖层点击关闭的是模态框而不是购物车\n            overlay.onclick = closeModal;\n        }\n\n        function closeModal() {\n            document.getElementById('product-modal').classList.remove('active');\n            document.getElementById('overlay').classList.remove('active');\n            document.getElementById('cart-sidebar').classList.remove('open');\n            // 重置overlay点击事件为默认\n            document.getElementById('overlay').onclick = () => { toggleCart(); closeModal(); };\n        }\n\n        function showToast(msg, isError = false) {\n            const toast = document.getElementById('toast');\n            const msgEl = document.getElementById('toast-msg');\n            msgEl.textContent = msg;\n            toast.querySelector('svg').style.stroke = isError ? '#ef4444' : '#4ade80';\n            toast.classList.add('show');\n            setTimeout(() => {\n                toast.classList.remove('show');\n            }, 2000);\n        }\n\n        function checkout() {\n            if (cart.length === 0) {\n                showToast('购物车为空', true);\n                return;\n            }\n            alert(`感谢您的购买！总金额: ${document.getElementById('cart-total-price').textContent}`);\n            cart = [];\n            saveCart();\n            updateCartUI();\n            toggleCart();\n        }\n\n        // === 倒计时逻辑 ===\n        function startCountdown() {\n            let time = 7200; // 2小时秒数\n            const el = document.getElementById('countdown');\n            \n            setInterval(() => {\n                time--;\n                if (time < 0) time = 7200; // 循环\n                \n                const h = Math.floor(time / 3600).toString().padStart(2, '0');\n                const m = Math.floor((time % 3600) / 60).toString().padStart(2, '0');\n                const s = (time % 60).toString().padStart(2, '0');\n                \n                el.textContent = `${h}:${m}:${s}`;\n            }, 1000);\n        }\n    </script>\n</body>\n</html>"
    }
  ]
}