{
  "brief": [
    {
      "topic": "brief",
      "sender": "User",
      "content": "\n为网站创建一个响应式且视觉效果吸引人的电商产品销售页面小部件。\n用户应能够浏览商品列表、查看商品详情、选择数量并加入购物车，以及从购物车中删除商品。页面应支持显示商品价格、折扣信息、库存状态和按分类浏览等功能。\n您还可以添加任何其他创意功能来提高转化率和趣味性，例如限时倒计时、热销标记或简易订单摘要。\n仅使用 HTML、CSS 和 JavaScript — 不要使用 Vue、React 或任何第三方库。使用 localStorage 存储购物车等数据，确保信息在页面刷新后仍能保留。保持整体设计简洁、用户友好且引人入胜。\n"
    }
  ],
  "tasks": [
    {
      "topic": "tasks",
      "sender": "TeamLeader",
      "content": {
        "available_roles": [
          "TeamLeader",
          "Engineer"
        ],
        "tasks": [
          {
            "role": "TeamLeader",
            "tasks": [
              "分析需求：创建响应式电商产品销售小部件",
              "明确功能点：商品展示、购物车管理（增删改）、详情查看、分类筛选、LocalStorage 数据持久化",
              "确认技术约束：仅使用原生 HTML/CSS/JS"
            ]
          },
          {
            "role": "Engineer",
            "tasks": [
              "设计 Mock 商品数据结构",
              "编写 HTML 结构（商品网格、侧边栏/弹窗购物车、详情模态框）",
              "实现 CSS 响应式布局与视觉设计",
              "开发 JavaScript 核心逻辑（渲染商品、购物车状态管理、LocalStorage 读写、交互事件绑定）"
            ]
          }
        ]
      }
    }
  ],
  "html": [
    {
      "topic": "html",
      "sender": "Engineer",
      "content": "<!DOCTYPE html>\n<html lang=\"zh-CN\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>极简生活 | 精选好物</title>\n    <style>\n        :root {\n            --primary-color: #2563eb;\n            --primary-hover: #1d4ed8;\n            --secondary-color: #f3f4f6;\n            --text-main: #1f2937;\n            --text-light: #6b7280;\n            --accent-red: #ef4444;\n            --accent-green: #10b981;\n            --white: #ffffff;\n            --border-radius: 12px;\n            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);\n            --transition: all 0.3s ease;\n        }\n\n        * {\n            margin: 0;\n            padding: 0;\n            box-sizing: border-box;\n            font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, \"Helvetica Neue\", Arial, sans-serif;\n        }\n\n        body {\n            background-color: #f9fafb;\n            color: var(--text-main);\n            padding-bottom: 80px; /* Space for mobile footer if needed */\n        }\n\n        /* Header & Nav */\n        header {\n            background: var(--white);\n            position: sticky;\n            top: 0;\n            z-index: 100;\n            box-shadow: 0 1px 3px rgba(0,0,0,0.1);\n            padding: 1rem 5%;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .brand {\n            font-size: 1.5rem;\n            font-weight: 700;\n            color: var(--primary-color);\n            letter-spacing: -0.5px;\n        }\n\n        .cart-trigger {\n            position: relative;\n            cursor: pointer;\n            padding: 8px;\n        }\n\n        .cart-icon {\n            width: 28px;\n            height: 28px;\n            fill: none;\n            stroke: var(--text-main);\n            stroke-width: 2;\n        }\n\n        .cart-badge {\n            position: absolute;\n            top: 0;\n            right: 0;\n            background: var(--accent-red);\n            color: white;\n            font-size: 0.7rem;\n            font-weight: bold;\n            width: 20px;\n            height: 20px;\n            border-radius: 50%;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            transform: scale(0);\n            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);\n        }\n\n        .cart-badge.active {\n            transform: scale(1);\n        }\n\n        /* Promo Banner */\n        .promo-banner {\n            background: linear-gradient(135deg, #2563eb, #4f46e5);\n            color: white;\n            text-align: center;\n            padding: 1rem;\n            font-weight: 500;\n            display: flex;\n            justify-content: center;\n            gap: 15px;\n            flex-wrap: wrap;\n        }\n\n        .countdown span {\n            background: rgba(255,255,255,0.2);\n            padding: 2px 6px;\n            border-radius: 4px;\n            font-family: monospace;\n        }\n\n        /* Filters */\n        .filters {\n            display: flex;\n            justify-content: center;\n            gap: 10px;\n            padding: 2rem 1rem;\n            flex-wrap: wrap;\n        }\n\n        .filter-btn {\n            background: var(--white);\n            border: 1px solid #e5e7eb;\n            padding: 8px 20px;\n            border-radius: 50px;\n            cursor: pointer;\n            transition: var(--transition);\n            font-weight: 500;\n        }\n\n        .filter-btn:hover, .filter-btn.active {\n            background: var(--text-main);\n            color: var(--white);\n            border-color: var(--text-main);\n        }\n\n        /* Product Grid */\n        .container {\n            max-width: 1200px;\n            margin: 0 auto;\n            padding: 0 1rem;\n        }\n\n        .product-grid {\n            display: grid;\n            grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));\n            gap: 2rem;\n            padding-bottom: 2rem;\n        }\n\n        /* Product Card */\n        .product-card {\n            background: var(--white);\n            border-radius: var(--border-radius);\n            overflow: hidden;\n            box-shadow: var(--shadow);\n            transition: var(--transition);\n            position: relative;\n            display: flex;\n            flex-direction: column;\n        }\n\n        .product-card:hover {\n            transform: translateY(-5px);\n            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);\n        }\n\n        .card-image-wrapper {\n            position: relative;\n            width: 100%;\n            padding-top: 100%; /* 1:1 Aspect Ratio */\n            background: #f3f4f6;\n            overflow: hidden;\n        }\n\n        .card-image {\n            position: absolute;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            object-fit: cover;\n            transition: transform 0.5s ease;\n        }\n\n        .product-card:hover .card-image {\n            transform: scale(1.05);\n        }\n\n        .badge {\n            position: absolute;\n            top: 10px;\n            left: 10px;\n            padding: 4px 10px;\n            border-radius: 4px;\n            font-size: 0.75rem;\n            font-weight: bold;\n            color: white;\n            z-index: 2;\n        }\n\n        .badge.hot { background: var(--accent-red); }\n        .badge.sale { background: var(--accent-green); }\n\n        .card-content {\n            padding: 1.25rem;\n            flex-grow: 1;\n            display: flex;\n            flex-direction: column;\n        }\n\n        .category-tag {\n            color: var(--text-light);\n            font-size: 0.8rem;\n            text-transform: uppercase;\n            letter-spacing: 1px;\n            margin-bottom: 0.5rem;\n        }\n\n        .product-title {\n            font-size: 1.1rem;\n            font-weight: 600;\n            margin-bottom: 0.5rem;\n            color: var(--text-main);\n        }\n\n        .price-wrapper {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            margin-bottom: 1rem;\n        }\n\n        .current-price {\n            font-size: 1.2rem;\n            font-weight: 700;\n            color: var(--primary-color);\n        }\n\n        .original-price {\n            text-decoration: line-through;\n            color: #9ca3af;\n            font-size: 0.9rem;\n        }\n\n        .stock-status {\n            font-size: 0.8rem;\n            margin-bottom: 1rem;\n        }\n\n        .stock-status.low { color: #eab308; }\n        .stock-status.out { color: var(--accent-red); }\n\n        .card-actions {\n            margin-top: auto;\n            display: flex;\n            gap: 10px;\n        }\n\n        .btn {\n            padding: 10px 16px;\n            border: none;\n            border-radius: 8px;\n            cursor: pointer;\n            font-weight: 600;\n            transition: var(--transition);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            gap: 6px;\n        }\n\n        .btn-primary {\n            background: var(--primary-color);\n            color: white;\n            flex: 1;\n        }\n\n        .btn-primary:hover { background: var(--primary-hover); }\n\n        .btn-outline {\n            background: transparent;\n            border: 1px solid #d1d5db;\n            color: var(--text-main);\n        }\n\n        .btn-outline:hover { border-color: var(--text-main); background: #f9fafb; }\n\n        /* Cart Sidebar */\n        .cart-overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0,0,0,0.5);\n            z-index: 999;\n            opacity: 0;\n            visibility: hidden;\n            transition: var(--transition);\n        }\n\n        .cart-sidebar {\n            position: fixed;\n            top: 0;\n            right: -400px;\n            width: 100%;\n            max-width: 400px;\n            height: 100vh;\n            background: var(--white);\n            z-index: 1000;\n            transition: cubic-bezier(0.4, 0, 0.2, 1) 0.4s;\n            display: flex;\n            flex-direction: column;\n            box-shadow: -5px 0 15px rgba(0,0,0,0.1);\n        }\n\n        .cart-open .cart-overlay { opacity: 1; visibility: visible; }\n        .cart-open .cart-sidebar { right: 0; }\n\n        .cart-header {\n            padding: 1.5rem;\n            border-bottom: 1px solid #f3f4f6;\n            display: flex;\n            justify-content: space-between;\n            align-items: center;\n        }\n\n        .close-cart {\n            background: none;\n            border: none;\n            font-size: 1.5rem;\n            cursor: pointer;\n        }\n\n        .cart-items {\n            flex-grow: 1;\n            overflow-y: auto;\n            padding: 1.5rem;\n        }\n\n        .cart-item {\n            display: flex;\n            gap: 1rem;\n            margin-bottom: 1.5rem;\n            border-bottom: 1px solid #f3f4f6;\n            padding-bottom: 1rem;\n            animation: fadeIn 0.3s ease;\n        }\n\n        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }\n\n        .cart-item img {\n            width: 70px;\n            height: 70px;\n            border-radius: 8px;\n            object-fit: cover;\n        }\n\n        .item-details { flex-grow: 1; }\n        .item-title { font-weight: 600; font-size: 0.95rem; }\n        .item-price { color: var(--text-light); font-size: 0.9rem; margin: 4px 0; }\n\n        .qty-controls {\n            display: flex;\n            align-items: center;\n            gap: 10px;\n            margin-top: 8px;\n        }\n\n        .qty-btn {\n            width: 24px;\n            height: 24px;\n            border-radius: 4px;\n            border: 1px solid #d1d5db;\n            background: white;\n            cursor: pointer;\n            display: flex;\n            align-items: center;\n            justify-content: center;\n        }\n\n        .qty-btn:hover { background: #f3f4f6; }\n\n        .remove-btn {\n            color: var(--accent-red);\n            font-size: 0.8rem;\n            cursor: pointer;\n            text-decoration: underline;\n            margin-left: auto;\n        }\n\n        .cart-footer {\n            padding: 1.5rem;\n            border-top: 1px solid #f3f4f6;\n            background: #fafafa;\n        }\n\n        .summary-row {\n            display: flex;\n            justify-content: space-between;\n            margin-bottom: 0.5rem;\n            color: var(--text-light);\n        }\n\n        .summary-total {\n            display: flex;\n            justify-content: space-between;\n            margin-top: 1rem;\n            font-size: 1.2rem;\n            font-weight: 700;\n            color: var(--text-main);\n        }\n\n        .checkout-btn {\n            width: 100%;\n            padding: 14px;\n            background: var(--text-main);\n            color: white;\n            border: none;\n            border-radius: 8px;\n            font-size: 1rem;\n            font-weight: 600;\n            margin-top: 1.5rem;\n            cursor: pointer;\n        }\n        \n        .checkout-btn:hover { opacity: 0.9; }\n\n        .empty-cart-msg {\n            text-align: center;\n            color: var(--text-light);\n            margin-top: 3rem;\n        }\n\n        /* Modal */\n        .modal-overlay {\n            position: fixed;\n            top: 0;\n            left: 0;\n            width: 100%;\n            height: 100%;\n            background: rgba(0,0,0,0.6);\n            display: flex;\n            align-items: center;\n            justify-content: center;\n            z-index: 2000;\n            opacity: 0;\n            visibility: hidden;\n            transition: var(--transition);\n            padding: 1rem;\n        }\n\n        .modal-overlay.active { opacity: 1; visibility: visible; }\n\n        .modal-content {\n            background: white;\n            width: 100%;\n            max-width: 800px;\n            border-radius: 16px;\n            display: flex;\n            overflow: hidden;\n            position: relative;\n            max-height: 90vh;\n            flex-direction: column;\n        }\n\n        .close-modal {\n            position: absolute;\n            top: 15px;\n            right: 15px;\n            background: rgba(255,255,255,0.8);\n            border: none;\n            border-radius: 50%;\n            width: 32px;\n            height: 32px;\n            font-size: 1.2rem;\n            cursor: pointer;\n            z-index: 10;\n        }\n\n        .modal-body {\n            display: flex;\n            flex-direction: row;\n            overflow-y: auto;\n        }\n\n        .modal-img {\n            width: 50%;\n            object-fit: cover;\n            min-height: 300px;\n        }\n\n        .modal-details {\n            padding: 2rem;\n            width: 50%;\n        }\n\n        @media (max-width: 768px) {\n            .modal-body { flex-direction: column; }\n            .modal-img, .modal-details { width: 100%; }\n            .modal-img { height: 250px; }\n        }\n\n        /* Notification Toast */\n        .toast {\n            position: fixed;\n            bottom: 20px;\n            left: 50%;\n            transform: translateX(-50%) translateY(100px);\n            background: var(--text-main);\n            color: white;\n            padding: 12px 24px;\n            border-radius: 50px;\n            font-weight: 500;\n            z-index: 3000;\n            transition: transform 0.3s ease;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.15);\n        }\n\n        .toast.show { transform: translateX(-50%) translateY(0); }\n\n    </style>\n</head>\n<body>\n\n    <!-- Header -->\n    <header>\n        <div class=\"brand\">MMinimal.</div>\n        <div class=\"cart-trigger\" onclick=\"toggleCart()\">\n            <svg class=\"cart-icon\" viewBox=\"0 0 24 24\">\n                <path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z\" />\n            </svg>\n            <div class=\"cart-badge\" id=\"cart-count\">0</div>\n        </div>\n    </header>\n\n    <!-- Promo Banner -->\n    <div class=\"promo-banner\">\n        <span>⚡ 限时闪购：全场商品 8 折优惠！</span>\n        <div class=\"countdown\" id=\"countdown\">\n            <span id=\"cd-h\">00</span> : <span id=\"cd-m\">00</span> : <span id=\"cd-s\">00</span>\n        </div>\n    </div>\n\n    <!-- Filter Navigation -->\n    <nav class=\"filters\" id=\"filter-container\">\n        <button class=\"filter-btn active\" onclick=\"filterProducts('all', this)\">全部</button>\n        <button class=\"filter-btn\" onclick=\"filterProducts('electronics', this)\">数码</button>\n        <button class=\"filter-btn\" onclick=\"filterProducts('lifestyle', this)\">生活</button>\n        <button class=\"filter-btn\" onclick=\"filterProducts('clothing', this)\">服饰</button>\n    </nav>\n\n    <!-- Product Grid -->\n    <main class=\"container\">\n        <div class=\"product-grid\" id=\"product-grid\">\n            <!-- Products rendered via JS -->\n        </div>\n    </main>\n\n    <!-- Cart Sidebar -->\n    <div id=\"cart-wrapper\">\n        <div class=\"cart-overlay\" onclick=\"toggleCart()\"></div>\n        <aside class=\"cart-sidebar\">\n            <div class=\"cart-header\">\n                <h2>购物车</h2>\n                <button class=\"close-cart\" onclick=\"toggleCart()\">×</button>\n            </div>\n            <div class=\"cart-items\" id=\"cart-items-container\">\n                <!-- Cart Items rendered via JS -->\n            </div>\n            <div class=\"cart-footer\">\n                <div class=\"summary-row\">\n                    <span>小计</span>\n                    <span id=\"cart-subtotal\">¥0.00</span>\n                </div>\n                <div class=\"summary-row\">\n                    <span>折扣 (20%)</span>\n                    <span id=\"cart-discount\" style=\"color: var(--accent-red)\">-¥0.00</span>\n                </div>\n                <div class=\"summary-total\">\n                    <span>总计</span>\n                    <span id=\"cart-total\">¥0.00</span>\n                </div>\n                <button class=\"checkout-btn\" onclick=\"alert('感谢您的试用！功能开发中。')\">立即结算</button>\n            </div>\n        </aside>\n    </div>\n\n    <!-- Product Detail Modal -->\n    <div class=\"modal-overlay\" id=\"product-modal\" onclick=\"closeModal(event)\">\n        <div class=\"modal-content\" id=\"modal-content\">\n            <button class=\"close-modal\" onclick=\"closeModal(event, true)\">×</button>\n            <div class=\"modal-body\">\n                <!-- Injected via JS -->\n            </div>\n        </div>\n    </div>\n\n    <!-- Toast Notification -->\n    <div class=\"toast\" id=\"toast\">已加入购物车</div>\n\n    <script>\n        // --- Mock Data ---\n        const products = [\n            {\n                id: 1,\n                name: \"无线降噪耳机 Pro\",\n                price: 1299,\n                originalPrice: 1599,\n                category: \"electronics\",\n                image: \"https://placehold.co/600x600/252f3f/FFF?text=Headphones\",\n                stock: 15,\n                badges: [\"sale\", \"hot\"],\n                desc: \"沉浸式音效体验，40小时超长续航，无论是通勤还是专注工作，都是您的最佳伴侣。\"\n            },\n            {\n                id: 2,\n                name: \"极简机械键盘\",\n                price: 499,\n                originalPrice: 499,\n                category: \"electronics\",\n                image: \"https://placehold.co/600x600/e5e7eb/1f2937?text=Keyboard\",\n                stock: 3,\n                badges: [\"hot\"],\n                desc: \"87键布局，PBT键帽，青轴手感清脆，专为程序员和写作者设计。\"\n            },\n            {\n                id: 3,\n                name: \"智能保温咖啡杯\",\n                price: 199,\n                originalPrice: 259,\n                category: \"lifestyle\",\n                image: \"https://placehold.co/600x600/d97706/FFF?text=Smart+Mug\",\n                stock: 20,\n                badges: [\"sale\"],\n                desc: \"手机APP控制温度，保持饮品最佳口感，IPX7级防水设计。\"\n            },\n            {\n                id: 4,\n                name: \"日式棉麻休闲衬衫\",\n                price: 159,\n                originalPrice: 159,\n                category: \"clothing\",\n                image: \"https://placehold.co/600x600/57534e/FFF?text=Shirt\",\n                stock: 50,\n                badges: [],\n                desc: \"透气亲肤，宽松版型，适合春秋季节穿着，回归自然舒适。\"\n            },\n            {\n                id: 5,\n                name: \"4K 高清网络摄像头\",\n                price: 699,\n                originalPrice: 899,\n                category: \"electronics\",\n                image: \"https://placehold.co/600x600/000/FFF?text=Webcam\",\n                stock: 8,\n                badges: [\"sale\"],\n                desc: \"直播级画质，自动对焦，内置降噪麦克风，远程会议必备。\"\n            },\n            {\n                id: 6,\n                name: \"人体工学办公椅\",\n                price: 899,\n                originalPrice: 899,\n                category: \"lifestyle\",\n                image: \"https://placehold.co/600x600/3b82f6/FFF?text=Chair\",\n                stock: 0,\n                badges: [],\n                desc: \"多点支撑设计，护腰护颈，久坐不累，透气网布材质。\"\n            }\n        ];\n\n        // --- State Management ---\n        let cart = JSON.parse(localStorage.getItem('myShopCart')) || [];\n\n        // --- DOM Elements ---\n        const grid = document.getElementById('product-grid');\n        const cartCount = document.getElementById('cart-count');\n        const cartItemsContainer = document.getElementById('cart-items-container');\n        const cartWrapper = document.getElementById('cart-wrapper');\n        const modalOverlay = document.getElementById('product-modal');\n        \n        // --- Initialization ---\n        function init() {\n            renderProducts('all');\n            updateCartUI();\n            startTimer();\n        }\n\n        // --- Render Products ---\n        function renderProducts(filter) {\n            grid.innerHTML = '';\n            const filtered = filter === 'all' ? products : products.filter(p => p.category === filter);\n\n            filtered.forEach(p => {\n                const isSale = p.originalPrice > p.price;\n                const discount = isSale ? Math.round(((p.originalPrice - p.price) / p.originalPrice) * 100) : 0;\n                \n                // Badges\n                let badgeHTML = '';\n                if (p.badges.includes('hot')) badgeHTML += `<span class=\"badge hot\">热销</span>`;\n                else if (p.badges.includes('sale')) badgeHTML += `<span class=\"badge sale\">-${discount}%</span>`;\n\n                // Stock\n                let stockHTML = '';\n                if (p.stock === 0) stockHTML = `<div class=\"stock-status out\">已售罄</div>`;\n                else if (p.stock < 5) stockHTML = `<div class=\"stock-status low\">仅剩 ${p.stock} 件</div>`;\n\n                const card = document.createElement('div');\n                card.className = 'product-card';\n                card.innerHTML = `\n                    <div class=\"card-image-wrapper\">\n                        ${badgeHTML}\n                        <img src=\"${p.image}\" alt=\"${p.name}\" class=\"card-image\">\n                    </div>\n                    <div class=\"card-content\">\n                        <div class=\"category-tag\">${p.category}</div>\n                        <h3 class=\"product-title\">${p.name}</h3>\n                        <div class=\"price-wrapper\">\n                            <span class=\"current-price\">¥${p.price}</span>\n                            ${isSale ? `<span class=\"original-price\">¥${p.originalPrice}</span>` : ''}\n                        </div>\n                        ${stockHTML}\n                        <div class=\"card-actions\">\n                            <button class=\"btn btn-outline\" onclick=\"openModal(${p.id})\">详情</button>\n                            <button class=\"btn btn-primary\" ${p.stock === 0 ? 'disabled style=\"opacity:0.5;cursor:not-allowed\"' : ''} onclick=\"addToCart(${p.id})\">\n                                ${p.stock === 0 ? '缺货' : '加入购物车'}\n                            </button>\n                        </div>\n                    </div>\n                `;\n                grid.appendChild(card);\n            });\n        }\n\n        function filterProducts(cat, btn) {\n            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));\n            btn.classList.add('active');\n            renderProducts(cat);\n        }\n\n        // --- Cart Logic ---\n        function addToCart(id) {\n            const product = products.find(p => p.id === id);\n            if (!product || product.stock === 0) return;\n\n            const existingItem = cart.find(item => item.id === id);\n            \n            if (existingItem) {\n                if (existingItem.qty < product.stock) {\n                    existingItem.qty++;\n                    showToast('购物车数量 +1');\n                } else {\n                    showToast('库存不足', true);\n                    return;\n                }\n            } else {\n                cart.push({ id: product.id, qty: 1 });\n                showToast('已加入购物车');\n            }\n\n            saveCart();\n            updateCartUI();\n        }\n\n        function removeFromCart(id) {\n            cart = cart.filter(item => item.id !== id);\n            saveCart();\n            updateCartUI();\n        }\n\n        function changeQty(id, change) {\n            const item = cart.find(i => i.id === id);\n            const product = products.find(p => p.id === id);\n            \n            if (!item) return;\n\n            const newQty = item.qty + change;\n            if (newQty > 0 && newQty <= product.stock) {\n                item.qty = newQty;\n            } else if (newQty <= 0) {\n                return removeFromCart(id);\n            } else {\n                showToast('库存上限', true);\n            }\n\n            saveCart();\n            updateCartUI();\n        }\n\n        function saveCart() {\n            localStorage.setItem('myShopCart', JSON.stringify(cart));\n        }\n\n        function updateCartUI() {\n            // Update Badge\n            const totalCount = cart.reduce((acc, item) => acc + item.qty, 0);\n            cartCount.innerText = totalCount;\n            cartCount.classList.toggle('active', totalCount > 0);\n\n            // Render Items\n            cartItemsContainer.innerHTML = '';\n            let subtotal = 0;\n\n            if (cart.length === 0) {\n                cartItemsContainer.innerHTML = '<div class=\"empty-cart-msg\">购物车是空的</div>';\n            } else {\n                cart.forEach(item => {\n                    const product = products.find(p => p.id === item.id);\n                    subtotal += product.price * item.qty;\n\n                    const div = document.createElement('div');\n                    div.className = 'cart-item';\n                    div.innerHTML = `\n                        <img src=\"${product.image}\" alt=\"${product.name}\">\n                        <div class=\"item-details\">\n                            <div class=\"item-title\">${product.name}</div>\n                            <div class=\"item-price\">¥${product.price}</div>\n                            <div class=\"qty-controls\">\n                                <button class=\"qty-btn\" onclick=\"changeQty(${item.id}, -1)\">-</button>\n                                <span>${item.qty}</span>\n                                <button class=\"qty-btn\" onclick=\"changeQty(${item.id}, 1)\">+</button>\n                                <span class=\"remove-btn\" onclick=\"removeFromCart(${item.id})\">删除</span>\n                            </div>\n                        </div>\n                    `;\n                    cartItemsContainer.appendChild(div);\n                });\n            }\n\n            // Totals\n            const discount = subtotal * 0.2; // Mock 20% discount logic from banner\n            const total = subtotal - discount;\n\n            document.getElementById('cart-subtotal').innerText = `¥${subtotal.toFixed(2)}`;\n            document.getElementById('cart-discount').innerText = `-¥${discount.toFixed(2)}`;\n            document.getElementById('cart-total').innerText = `¥${total.toFixed(2)}`;\n        }\n\n        function toggleCart() {\n            cartWrapper.classList.toggle('cart-open');\n        }\n\n        // --- Modal Logic ---\n        function openModal(id) {\n            const product = products.find(p => p.id === id);\n            const modalBody = document.querySelector('.modal-body');\n            \n            modalBody.innerHTML = `\n                <img src=\"${product.image}\" class=\"modal-img\" alt=\"${product.name}\">\n                <div class=\"modal-details\">\n                    <div class=\"category-tag\">${product.category}</div>\n                    <h2 style=\"margin-bottom: 10px; font-size: 1.5rem;\">${product.name}</h2>\n                    <p style=\"color: #666; line-height: 1.6; margin-bottom: 20px;\">${product.desc}</p>\n                    <div class=\"price-wrapper\">\n                        <span class=\"current-price\" style=\"font-size: 1.5rem\">¥${product.price}</span>\n                        ${product.originalPrice > product.price ? `<span class=\"original-price\">¥${product.originalPrice}</span>` : ''}\n                    </div>\n                    <div style=\"margin-top: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px;\">\n                        <p style=\"font-size: 0.9rem; margin-bottom: 5px;\"><strong>库存状态:</strong> ${product.stock > 0 ? '有货 (' + product.stock + ')' : '缺货'}</p>\n                        <p style=\"font-size: 0.9rem;\"><strong>配送:</strong> 预计 24 小时内发货</p>\n                    </div>\n                    <button class=\"btn btn-primary\" style=\"width: 100%; margin-top: 20px; padding: 15px;\" \n                        onclick=\"addToCart(${product.id}); closeModal(event, true)\" \n                        ${product.stock === 0 ? 'disabled' : ''}>\n                        ${product.stock === 0 ? '暂时缺货' : '加入购物车'}\n                    </button>\n                </div>\n            `;\n            \n            modalOverlay.classList.add('active');\n        }\n\n        function closeModal(e, force = false) {\n            if (force || e.target === modalOverlay) {\n                modalOverlay.classList.remove('active');\n            }\n        }\n\n        // --- Utilities ---\n        function showToast(msg, isError = false) {\n            const toast = document.getElementById('toast');\n            toast.innerText = msg;\n            toast.style.background = isError ? '#ef4444' : '#1f2937';\n            toast.classList.add('show');\n            setTimeout(() => toast.classList.remove('show'), 2000);\n        }\n\n        function startTimer() {\n            let time = 7200; // 2 hours in seconds\n            const h = document.getElementById('cd-h');\n            const m = document.getElementById('cd-m');\n            const s = document.getElementById('cd-s');\n\n            setInterval(() => {\n                time--;\n                if (time < 0) time = 7200;\n                \n                const hrs = Math.floor(time / 3600);\n                const mins = Math.floor((time % 3600) / 60);\n                const secs = time % 60;\n\n                h.innerText = hrs.toString().padStart(2, '0');\n                m.innerText = mins.toString().padStart(2, '0');\n                s.innerText = secs.toString().padStart(2, '0');\n            }, 1000);\n        }\n\n        // Run\n        init();\n\n    </script>\n</body>\n</html>"
    }
  ]
}