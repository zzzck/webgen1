<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LYF å¹´è´§å¤§ä¿ƒ | ç»å…¸é¦™ç“œå­ç‰¹æƒ </title>
    <style>
        :root {
            --primary-red: #E4393C; /* äº¬ä¸œçº¢/æ˜¥èŠ‚çº¢ */
            --primary-dark: #c81623;
            --accent-gold: #FF9600;
            --text-dark: #333333;
            --text-gray: #666666;
            --bg-light: #F4F4F5;
            --border-color: #ddd;
            --white: #ffffff;
            --spacing-unit: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg-light);
            color: var(--text-dark);
            line-height: 1.5;
        }

        /* é€šç”¨å·¥å…·ç±» */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 var(--spacing-unit);
        }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .text-red { color: var(--primary-red); }
        .font-bold { font-weight: bold; }
        .btn {
            cursor: pointer;
            border: none;
            outline: none;
            transition: all 0.3s ease;
        }

        /* Header */
        header {
            background: var(--white);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
            padding: 10px 0;
        }
        .logo {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary-red);
            text-decoration: none;
        }
        .nav-links a {
            margin: 0 15px;
            text-decoration: none;
            color: var(--text-dark);
            font-weight: 500;
        }
        .nav-links a:hover { color: var(--primary-red); }
        .cart-icon-wrapper {
            position: relative;
            cursor: pointer;
            font-size: 24px;
        }
        .cart-badge {
            position: absolute;
            top: -8px;
            right: -10px;
            background: var(--primary-red);
            color: white;
            border-radius: 50%;
            padding: 2px 6px;
            font-size: 12px;
            font-weight: bold;
        }

        /* Main Product Section */
        .product-hero {
            background: var(--white);
            margin-top: 20px;
            padding: 30px 0;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            flex-wrap: wrap;
            gap: 40px;
        }

        /* Gallery */
        .gallery {
            flex: 1;
            min-width: 300px;
            position: relative;
        }
        .main-image-container {
            width: 100%;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            border: 1px solid #eee;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        .main-image {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: transform 0.3s;
        }
        .thumbs {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        .thumb {
            width: 60px;
            height: 60px;
            border: 2px solid transparent;
            cursor: pointer;
            border-radius: 4px;
            overflow: hidden;
        }
        .thumb.active { border-color: var(--primary-red); }
        .thumb img { width: 100%; height: 100%; object-fit: cover; }

        /* Info */
        .product-info {
            flex: 1.2;
            min-width: 300px;
            padding-right: 20px;
        }
        .product-title {
            font-size: 28px;
            margin-bottom: 10px;
        }
        .product-subtitle {
            color: var(--primary-red);
            font-size: 16px;
            margin-bottom: 15px;
        }
        
        /* Price Box */
        .price-box {
            background: url('data:image/svg+xml;utf8,<svg width="100" height="100" xmlns="http://www.w3.org/2000/svg"><rect width="100" height="100" fill="%23fff5f5"/></svg>');
            background-color: #fff5f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            position: relative;
            overflow: hidden;
        }
        .countdown-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .promo-tag {
            background: linear-gradient(90deg, #ff9000, #ff5000);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .timer {
            color: var(--primary-red);
            font-weight: bold;
            font-family: monospace;
        }
        .current-price {
            font-size: 32px;
            color: var(--primary-red);
            font-weight: bold;
        }
        .current-price::before { content: 'Â¥'; font-size: 18px; }
        .original-price {
            text-decoration: line-through;
            color: var(--text-gray);
            margin-left: 10px;
        }
        .stock-tip {
            font-size: 12px;
            color: var(--accent-gold);
            margin-left: 15px;
        }

        /* Specs */
        .spec-group { margin-bottom: 20px; }
        .spec-label { display: block; color: var(--text-gray); margin-bottom: 8px; }
        .spec-options { display: flex; gap: 10px; }
        .spec-btn {
            background: white;
            border: 1px solid #ccc;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
        }
        .spec-btn.active {
            border-color: var(--primary-red);
            color: var(--primary-red);
            background: #fff5f5;
        }

        /* Actions */
        .action-row {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 30px;
        }
        .qty-selector {
            display: flex;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .qty-btn {
            width: 32px;
            height: 32px;
            background: #f8f8f8;
            border: none;
            font-size: 18px;
            cursor: pointer;
        }
        .qty-input {
            width: 50px;
            text-align: center;
            border: none;
            border-left: 1px solid #ddd;
            border-right: 1px solid #ddd;
        }
        .btn-add-cart {
            background: var(--primary-red);
            color: white;
            padding: 0 30px;
            height: 44px;
            border-radius: 22px;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            max-width: 200px;
        }
        .btn-add-cart:hover { background: var(--primary-dark); }
        .btn-wishlist {
            background: white;
            border: 1px solid #ddd;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #666;
        }
        .btn-wishlist.active { color: var(--primary-red); border-color: var(--primary-red); }

        /* Details & Reviews */
        .content-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .section-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .section-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            padding-left: 10px;
            border-left: 4px solid var(--primary-red);
        }
        .param-table { width: 100%; border-collapse: collapse; }
        .param-table td { padding: 8px; border-bottom: 1px solid #eee; color: var(--text-gray); }
        .param-table td:first-child { width: 100px; font-weight: 500; color: var(--text-dark); }

        .review-item { border-bottom: 1px solid #eee; padding: 15px 0; }
        .review-header { display: flex; justify-content: space-between; margin-bottom: 5px; }
        .stars { color: var(--accent-gold); }
        .review-form textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            resize: vertical;
        }

        /* Recommendations */
        .rec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        .rec-card {
            background: white;
            border-radius: 8px;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .rec-card:hover { transform: translateY(-5px); box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .rec-img { width: 100%; height: 150px; object-fit: cover; border-radius: 4px; margin-bottom: 10px; }
        .rec-price { color: var(--primary-red); font-weight: bold; }

        /* Cart Sidebar */
        .cart-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .cart-sidebar {
            position: fixed;
            top: 0; right: -400px;
            width: 350px;
            height: 100%;
            background: white;
            z-index: 1000;
            transition: right 0.3s;
            display: flex;
            flex-direction: column;
            box-shadow: -4px 0 15px rgba(0,0,0,0.1);
        }
        .cart-open .cart-overlay { opacity: 1; visibility: visible; }
        .cart-open .cart-sidebar { right: 0; }
        
        .cart-header { padding: 20px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: var(--primary-red); color: white; }
        .cart-items { flex: 1; overflow-y: auto; padding: 20px; }
        .cart-item { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid #f5f5f5; padding-bottom: 10px; }
        .cart-item img { width: 60px; height: 60px; object-fit: cover; border-radius: 4px; }
        .cart-item-details { flex: 1; }
        .cart-footer { padding: 20px; border-top: 1px solid #eee; background: #f9f9f9; }
        .btn-checkout { width: 100%; background: var(--primary-red); color: white; padding: 12px; border-radius: 25px; font-weight: bold; margin-top: 10px; }

        /* Toast Notification */
        #toast-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2000;
        }
        .toast {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            margin-bottom: 10px;
            animation: fadeInOut 3s forwards;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }

        /* Footer */
        footer { background: #333; color: #999; padding: 40px 0; text-align: center; margin-top: 40px; }
        
        /* Float Tools */
        .float-tools { position: fixed; bottom: 100px; right: 20px; display: flex; flex-direction: column; gap: 10px; z-index: 900; }
        .float-btn { width: 40px; height: 40px; background: white; border-radius: 50%; box-shadow: 0 2px 8px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-dark); font-size: 20px; }
        .float-btn:hover { color: var(--primary-red); }

        @media (max-width: 768px) {
            .product-hero { flex-direction: column; }
            .content-grid { grid-template-columns: 1fr; }
            .cart-sidebar { width: 100%; right: -100%; }
            .main-image-container { height: 300px; }
        }
    </style>
</head>
<body>

<!-- Header -->
<header>
    <div class="container flex justify-between items-center">
        <a href="#" class="logo">LYF<span style="font-size:14px; color:#333; margin-left:5px;">å¹´è´§èŠ‚</span></a>
        <nav class="nav-links" style="display: none;"> <!-- Mobile hide -->
            <a href="#">é¦–é¡µ</a>
            <a href="#">å…¨éƒ¨å¹´è´§</a>
            <a href="#">ä¼ä¸šå›¢è´­</a>
        </nav>
        <div class="flex items-center gap-4">
            <span style="font-size:14px; color: #666;">ä½ å¥½ï¼Œè¯·ç™»å½•</span>
            <div class="cart-icon-wrapper" onclick="cart.toggle()">
                ğŸ›’
                <span class="cart-badge" id="cart-count">0</span>
            </div>
        </div>
    </div>
</header>

<!-- Main Content -->
<main class="container">
    
    <!-- Product Hero -->
    <section class="product-hero">
        <!-- Left: Images -->
        <div class="gallery">
            <div class="main-image-container">
                <img id="main-img" src="" alt="Product Image" class="main-image">
            </div>
            <div class="thumbs" id="thumbs-container">
                <!-- Generated by JS -->
            </div>
        </div>

        <!-- Right: Info -->
        <div class="product-info">
            <h1 class="product-title">LYF ç»å…¸åŸå‘³é¦™ç“œå­/è‘µèŠ±å­ ä¼‘é—²é›¶é£Ÿç‚’è´§</h1>
            <p class="product-subtitle">ã€æ˜¥èŠ‚å¿…å¤‡ã€‘é¢—ç²’é¥±æ»¡ï¼Œäººå·¥ç²¾é€‰ï¼Œé…¥è„†å¯å£ï¼Œè€å°‘çš†å®œçš„å¹´è´§é¦–é€‰ï¼</p>
            
            <div class="price-box">
                <div class="countdown-bar">
                    <span class="promo-tag">å¹´è´§ç–¯æŠ¢</span>
                    <span class="promo-tag" style="background: #f23030;">é™æ—¶ç‰¹æƒ </span>
                    <span style="font-size: 12px; margin-left: auto;">è·ç¦»ç»“æŸï¼š<span class="timer" id="countdown">02:00:00</span></span>
                </div>
                <div>
                    <span class="current-price" id="display-price">0.00</span>
                    <span class="original-price" id="display-original">Â¥0.00</span>
                </div>
                <div style="margin-top: 8px; font-size: 13px; color: #e4393c;">
                    <span style="border: 1px solid #e4393c; padding: 0 4px; margin-right: 5px;">æ»¡99å‡20</span>
                    <span style="border: 1px solid #e4393c; padding: 0 4px;">å¤šä¹°å¤šé€</span>
                    <span class="stock-tip" id="stock-display">ä»…å‰© 24 ä»¶</span>
                </div>
            </div>

            <div class="spec-group">
                <label class="spec-label">é€‰æ‹©è§„æ ¼</label>
                <div class="spec-options" id="spec-container">
                    <!-- Generated by JS -->
                </div>
            </div>

            <div class="action-row">
                <div class="qty-selector">
                    <button class="qty-btn" onclick="app.updateQty(-1)">-</button>
                    <input type="text" class="qty-input" value="1" id="qty-input" readonly>
                    <button class="qty-btn" onclick="app.updateQty(1)">+</button>
                </div>
                <button class="btn btn-add-cart" onclick="app.addToCart()">åŠ å…¥è´­ç‰©è½¦</button>
                <button class="btn btn-wishlist" onclick="app.toggleWishlist(this)" title="åŠ å…¥å¿ƒæ„¿å•">â¤</button>
            </div>

            <ul style="margin-top: 20px; padding-left: 20px; font-size: 14px; color: #666; line-height: 1.8;">
                <li>âœ… <b>æºè‡ªäº§åœ°ï¼š</b> ç²¾é€‰å†…è’™/æ–°ç–†ä¼˜è´¨å‘æ—¥è‘µåŸºåœ°</li>
                <li>âœ… <b>å·¥è‰ºä¼ æ‰¿ï¼š</b> æ…¢ç«çƒ˜ç„™ï¼Œä¿ç•™è‡ªç„¶åŸé¦™</li>
                <li>âœ… <b>ç‹¬ç«‹åŒ…è£…ï¼š</b> é”ä½æ–°é²œï¼Œåˆ†äº«æ›´å«ç”Ÿ</li>
                <li>âœ… <b>æé€Ÿå‘è´§ï¼š</b> æ˜¥èŠ‚ä¸æ‰“çƒŠï¼Œ48å°æ—¶å†…å‘è´§</li>
            </ul>
        </div>
    </section>

    <div class="content-grid">
        <!-- Details & Reviews -->
        <div class="left-column">
            <div class="section-card">
                <div class="section-title">å•†å“è¯¦æƒ…</div>
                <table class="param-table">
                    <tr><td>å“ç‰Œ</td><td>LYF è‰¯ä¼˜å“</td></tr>
                    <tr><td>äº§åœ°</td><td>ä¸­å›½å¤§é™†</td></tr>
                    <tr><td>ä¿è´¨æœŸ</td><td>180 å¤©</td></tr>
                    <tr><td>å‚¨å­˜æ–¹æ³•</td><td>é˜´å‡‰å¹²ç‡¥å¤„å¯†å°ä¿å­˜</td></tr>
                    <tr><td>é…æ–™è¡¨</td><td>ç²¾é€‰è‘µèŠ±ç±½ã€é£Ÿç”¨ç›ã€é¦™è¾›æ–™ã€å®‰èµ›èœœã€é£Ÿç”¨é¦™ç²¾</td></tr>
                </table>
                <img src="https://gw.alicdn.com/imgextra/i3/3195305016/O1CN01FpNUtD1mvNZJLQUHu_!!3195305016.jpg_Q75.jpg_.webp" style="width:100%; margin-top:20px; border-radius:8px;">
            </div>

            <div class="section-card" id="reviews-section">
                <div class="section-title">ç”¨æˆ·è¯„ä»· (99+)</div>
                <div id="reviews-list">
                    <!-- Reviews injected here -->
                </div>
                
                <div class="review-form" style="margin-top: 20px; background: #f9f9f9; padding: 15px; border-radius: 8px;">
                    <h4 style="margin-bottom: 10px;">å‘è¡¨è¯„ä»·</h4>
                    <div style="margin-bottom: 10px;">
                        è¯„åˆ†ï¼š
                        <select id="review-rating">
                            <option value="5">â˜…â˜…â˜…â˜…â˜… (5)</option>
                            <option value="4">â˜…â˜…â˜…â˜…â˜† (4)</option>
                            <option value="3">â˜…â˜…â˜…â˜†â˜† (3)</option>
                        </select>
                    </div>
                    <textarea id="review-text" rows="3" placeholder="ç“œå­å‘³é“æ€ä¹ˆæ ·ï¼Ÿå’Œå¤§å®¶åˆ†äº«ä¸€ä¸‹å§..."></textarea>
                    <button class="btn" style="background: #333; color: white; padding: 5px 15px; border-radius: 4px;" onclick="app.addReview()">æäº¤è¯„ä»·</button>
                </div>
            </div>
        </div>

        <!-- Sidebar: Recommendations -->
        <div class="right-column">
            <div class="section-card">
                <div class="section-title">çœ‹äº†åˆçœ‹</div>
                <div class="rec-grid" id="rec-container">
                    <!-- Recommendations -->
                </div>
            </div>
            <div class="section-card">
                <div class="section-title">æµè§ˆè®°å½•</div>
                <div id="history-container" style="font-size: 14px; color: #666;">
                    <p>æš‚æ— æ›´å¤šæµè§ˆè®°å½•</p>
                </div>
            </div>
        </div>
    </div>

</main>

<!-- Footer -->
<footer>
    <div class="container">
        <p>Â© 2024 LYF é£Ÿå“å®˜æ–¹å•†åŸ | æ˜¥èŠ‚å¹´è´§èŠ‚ç‰¹åˆ«ç‰ˆ</p>
        <p>æ¶ˆè´¹è€…æœåŠ¡çƒ­çº¿ï¼š400-123-4567</p>
    </div>
</footer>

<!-- Cart Sidebar -->
<div id="cart-overlay" class="cart-overlay" onclick="cart.toggle()"></div>
<aside id="cart-sidebar" class="cart-sidebar">
    <div class="cart-header">
        <h3>è´­ç‰©è½¦ (<span id="cart-count-sidebar">0</span>)</h3>
        <span style="cursor:pointer; font-size: 24px;" onclick="cart.toggle()">Ã—</span>
    </div>
    <div class="cart-items" id="cart-items-container">
        <!-- Items -->
    </div>
    <div class="cart-footer">
        <div class="flex justify-between items-center" style="margin-bottom: 10px; font-size: 18px; font-weight: bold;">
            <span>åˆè®¡:</span>
            <span class="text-red" id="cart-total">Â¥0.00</span>
        </div>
        <button class="btn btn-checkout" onclick="cart.checkout()">å»ç»“ç®—</button>
    </div>
</aside>

<!-- Toast Container -->
<div id="toast-container"></div>

<!-- Floating Tools -->
<div class="float-tools">
    <div class="float-btn" onclick="alert('å®¢æœæ­£åœ¨è¿çº¿ä¸­...è¯·ç¨å€™')" title="è”ç³»å®¢æœ">ğŸ§</div>
    <div class="float-btn" onclick="window.scrollTo({top:0, behavior:'smooth'})" title="å›åˆ°é¡¶éƒ¨">â†‘</div>
</div>

<script>
/**
 * Data & State Management
 */
const productData = {
    id: 'p1001',
    baseTitle: 'LYF ç»å…¸åŸå‘³é¦™ç“œå­',
    images: [
        "https://gw.alicdn.com/imgextra/i3/3195305016/O1CN01FpNUtD1mvNZJLQUHu_!!3195305016.jpg_Q75.jpg_.webp",
        "https://pic1.zhimg.com/v2-0a72a4246fde463055bbcd021d58d6b0_1440w.jpg?source=172ae18b",
        "https://www.foodnext.net/dispPageBox/getFile/GetImg.aspx?FileLocation=%2FPJ-FOODNEXT%2FFiles%2F&FileName=photo-44541-i.jpg"
    ],
    specs: [
        { id: 's1', name: '10åŒ…å®¶åº­ç»„åˆè£…', price: 16.9, original: 29.9, stock: 24 },
        { id: 's2', name: '30g ç‹¬ç«‹å°åŒ…è£…', price: 1.99, original: 3.5, stock: 150 },
        { id: 's3', name: '500g å¤§è¢‹åˆ†äº«è£…', price: 9.9, original: 15.9, stock: 5 }
    ]
};

const recommendations = [
    { id: 'r1', name: 'å¼€å¿ƒæœ 250g', price: 39.9, img: 'https://gw.alicdn.com/imgextra/i3/3195305016/O1CN01FpNUtD1mvNZJLQUHu_!!3195305016.jpg_Q75.jpg_.webp' },
    { id: 'r2', name: 'æ‰‹å‰¥æ¾å­ 150g', price: 45.0, img: 'https://www.foodnext.net/dispPageBox/getFile/GetImg.aspx?FileLocation=%2FPJ-FOODNEXT%2FFiles%2F&FileName=photo-44541-i.jpg' },
    { id: 'r3', name: 'ç‚­çƒ§è…°æœ 200g', price: 28.5, img: 'https://pic1.zhimg.com/v2-0a72a4246fde463055bbcd021d58d6b0_1440w.jpg?source=172ae18b' }
];

// Initial Dummy Reviews
const initialReviews = [
    { user: 'å¼ **', score: 5, text: 'å‘è´§å¾ˆå¿«ï¼Œå¹´è´§å¿…å¤‡ï¼Œç“œå­å¾ˆå¤§é¢—ï¼', time: '2023-12-28' },
    { user: 'Li**', score: 5, text: 'åŒ…è£…å¾ˆå–œåº†ï¼Œé€ç¤¼ä¹Ÿåˆé€‚ï¼Œå‘³é“ä¸é”™ã€‚', time: '2023-12-29' },
    { user: 'ç‹**', score: 4, text: 'ç¨å¾®æœ‰ç‚¹æ…¢ï¼Œä½†æ˜¯ä¸œè¥¿å¾ˆå¥½åƒã€‚', time: '2024-01-02' }
];

// Application Logic
const app = {
    state: {
        currentSpecId: 's1',
        qty: 1,
        currentImgIdx: 0,
        cart: JSON.parse(localStorage.getItem('lyf_cart')) || [],
        reviews: JSON.parse(localStorage.getItem('lyf_reviews')) || initialReviews
    },

    init() {
        this.renderGallery();
        this.renderSpecs();
        this.renderProductInfo();
        this.renderReviews();
        this.renderRecs();
        cart.updateUI();
        this.startCountdown();
        
        // Record view (Simple implementation)
        let history = JSON.parse(localStorage.getItem('lyf_history')) || [];
        if(!history.includes(productData.baseTitle)) {
            history.push(productData.baseTitle);
            localStorage.setItem('lyf_history', JSON.stringify(history));
        }
    },

    get currentSpec() {
        return productData.specs.find(s => s.id === this.state.currentSpecId);
    },

    renderGallery() {
        const mainImg = document.getElementById('main-img');
        const thumbsContainer = document.getElementById('thumbs-container');
        
        mainImg.src = productData.images[this.state.currentImgIdx];
        
        thumbsContainer.innerHTML = productData.images.map((img, idx) => `
            <div class="thumb ${idx === this.state.currentImgIdx ? 'active' : ''}" 
                 onclick="app.changeImage(${idx})">
                <img src="${img}" alt="thumb">
            </div>
        `).join('');
    },

    changeImage(idx) {
        this.state.currentImgIdx = idx;
        this.renderGallery();
    },

    renderSpecs() {
        const container = document.getElementById('spec-container');
        container.innerHTML = productData.specs.map(spec => `
            <button class="spec-btn ${spec.id === this.state.currentSpecId ? 'active' : ''}" 
                    onclick="app.changeSpec('${spec.id}')">
                ${spec.name}
            </button>
        `).join('');
    },

    changeSpec(id) {
        this.state.currentSpecId = id;
        this.renderSpecs();
        this.renderProductInfo();
    },

    renderProductInfo() {
        const spec = this.currentSpec;
        document.getElementById('display-price').innerText = spec.price.toFixed(2);
        document.getElementById('display-original').innerText = 'Â¥' + spec.original.toFixed(2);
        
        const stockEl = document.getElementById('stock-display');
        stockEl.innerText = `ä»…å‰© ${spec.stock} ä»¶`;
        stockEl.style.color = spec.stock < 10 ? '#e4393c' : '#ff9600';
        
        if(spec.stock < 10) ui.toast('åº“å­˜ç´§å¼ ï¼Œè¯·å°½å¿«ä¸‹å•ï¼');
    },

    updateQty(delta) {
        let newQty = this.state.qty + delta;
        if(newQty < 1) newQty = 1;
        if(newQty > this.currentSpec.stock) {
            ui.toast('è´­ä¹°æ•°é‡è¶…è¿‡å½“å‰åº“å­˜');
            newQty = this.currentSpec.stock;
        }
        this.state.qty = newQty;
        document.getElementById('qty-input').value = newQty;
    },

    addToCart() {
        const spec = this.currentSpec;
        const item = {
            productId: productData.id,
            specId: spec.id,
            name: productData.baseTitle,
            specName: spec.name,
            price: spec.price,
            img: productData.images[0],
            qty: this.state.qty
        };

        cart.add(item);
        ui.toast(`å·²åŠ å…¥è´­ç‰©è½¦: ${spec.name} x${this.state.qty}`);
        
        // Reset qty
        this.state.qty = 1;
        document.getElementById('qty-input').value = 1;
    },

    toggleWishlist(btn) {
        btn.classList.toggle('active');
        if(btn.classList.contains('active')) {
            ui.toast('å·²åŠ å…¥å¿ƒæ„¿å•');
        } else {
            ui.toast('å·²ç§»å‡ºå¿ƒæ„¿å•');
        }
    },

    renderReviews() {
        const list = document.getElementById('reviews-list');
        list.innerHTML = this.state.reviews.map(r => `
            <div class="review-item">
                <div class="review-header">
                    <strong>${r.user}</strong>
                    <span class="stars">${'â˜…'.repeat(r.score)}${'â˜†'.repeat(5-r.score)}</span>
                </div>
                <p style="color:#555; margin: 5px 0;">${r.text}</p>
                <small style="color:#999;">${r.time}</small>
            </div>
        `).join('');
    },

    addReview() {
        const text = document.getElementById('review-text').value;
        const rating = document.getElementById('review-rating').value;
        if(!text) return ui.toast('è¯·è¾“å…¥è¯„ä»·å†…å®¹');

        const newReview = {
            user: 'æˆ‘ (æœ€æ–°)',
            score: parseInt(rating),
            text: text,
            time: new Date().toLocaleDateString()
        };

        this.state.reviews.unshift(newReview);
        localStorage.setItem('lyf_reviews', JSON.stringify(this.state.reviews));
        this.renderReviews();
        document.getElementById('review-text').value = '';
        ui.toast('è¯„ä»·æäº¤æˆåŠŸï¼');
    },

    renderRecs() {
        const container = document.getElementById('rec-container');
        container.innerHTML = recommendations.map(rec => `
            <div class="rec-card" onclick="ui.toast('æ¨¡æ‹Ÿè·³è½¬åˆ°: ${rec.name}')">
                <img src="${rec.img}" class="rec-img">
                <div style="font-size:14px;">${rec.name}</div>
                <div class="rec-price">Â¥${rec.price.toFixed(1)}</div>
            </div>
        `).join('');
    },

    startCountdown() {
        const timerEl = document.getElementById('countdown');
        let seconds = 7200; // 2 hours
        
        setInterval(() => {
            seconds--;
            if(seconds < 0) seconds = 7200;
            
            const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
            const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            
            timerEl.innerText = `${h}:${m}:${s}`;
        }, 1000);
    }
};

// Cart Logic
const cart = {
    items: app.state.cart,

    add(newItem) {
        const existing = this.items.find(i => i.specId === newItem.specId);
        if(existing) {
            existing.qty += newItem.qty;
        } else {
            this.items.push(newItem);
        }
        this.save();
        this.updateUI();
    },

    remove(specId) {
        this.items = this.items.filter(i => i.specId !== specId);
        this.save();
        this.updateUI();
    },

    changeQty(specId, delta) {
        const item = this.items.find(i => i.specId === specId);
        if(item) {
            item.qty += delta;
            if(item.qty < 1) item.qty = 1;
            this.save();
            this.updateUI();
        }
    },

    save() {
        localStorage.setItem('lyf_cart', JSON.stringify(this.items));
    },

    updateUI() {
        const count = this.items.reduce((sum, i) => sum + i.qty, 0);
        document.getElementById('cart-count').innerText = count;
        document.getElementById('cart-count-sidebar').innerText = count;

        // Render sidebar items
        const container = document.getElementById('cart-items-container');
        if(this.items.length === 0) {
            container.innerHTML = '<div style="text-align:center; margin-top:50px; color:#999;">è´­ç‰©è½¦ç©ºç©ºå¦‚ä¹Ÿ<br>å¿«å»åŠå¹´è´§å§ï¼</div>';
        } else {
            container.innerHTML = this.items.map(item => `
                <div class="cart-item">
                    <img src="${item.img}">
                    <div class="cart-item-details">
                        <div style="font-weight:bold; font-size:14px;">${item.name}</div>
                        <div style="font-size:12px; color:#666;">${item.specName}</div>
                        <div class="flex justify-between items-center" style="margin-top:5px;">
                            <span class="text-red">Â¥${item.price}</span>
                            <div class="qty-selector" style="transform: scale(0.8); transform-origin: right center;">
                                <button class="qty-btn" onclick="cart.changeQty('${item.specId}', -1)">-</button>
                                <input class="qty-input" value="${item.qty}" readonly>
                                <button class="qty-btn" onclick="cart.changeQty('${item.specId}', 1)">+</button>
                            </div>
                        </div>
                        <div style="text-align:right; font-size:12px; color:#999; margin-top:5px; cursor:pointer;" 
                             onclick="cart.remove('${item.specId}')">åˆ é™¤</div>
                    </div>
                </div>
            `).join('');
        }

        const total = this.items.reduce((sum, i) => sum + (i.price * i.qty), 0);
        document.getElementById('cart-total').innerText = 'Â¥' + total.toFixed(2);
    },

    toggle() {
        document.body.classList.toggle('cart-open');
    },

    checkout() {
        if(this.items.length === 0) return ui.toast('è´­ç‰©è½¦æ˜¯ç©ºçš„');
        const total = this.items.reduce((sum, i) => sum + (i.price * i.qty), 0);
        if(confirm(`å…±è®¡ Â¥${total.toFixed(2)}ï¼Œç¡®å®šæ¨¡æ‹Ÿç»“ç®—å—ï¼Ÿ`)) {
            this.items = [];
            this.save();
            this.updateUI();
            this.toggle();
            ui.toast('ğŸ‰ æ”¯ä»˜æˆåŠŸï¼æ­å–œå‘è´¢ï¼');
        }
    }
};

// UI Utilities
const ui = {
    toast(msg) {
        const container = document.getElementById('toast-container');
        const el = document.createElement('div');
        el.className = 'toast';
        el.innerText = msg;
        container.appendChild(el);
        setTimeout(() => el.remove(), 3000);
    }
};

// Run
window.onload = () => app.init();

</script>
</body>
</html>